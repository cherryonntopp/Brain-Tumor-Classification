<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain MRI Analyzer</title>
    <!-- Correct Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lato Font -->
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <!-- Font Awesome for the back icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Lato', sans-serif;
            color: #2c3852;
        }
        .banner-bg {
            background-image: url('https://www.itnonline.com/sites/default/files/field/image/158096096_m.jpg');
            background-size: cover;
            background-position: center;
        }
    </style>
</head>
<body class="bg-[#dce8f4] font-Lato leading-normal tracking-normal text-gray-900">


    <!-- New Banner Section -->
    <div class="banner-bg relative text-white py-20 px-4 text-center">
        <!-- Overlay to ensure text readability -->
        <div class="bg-gray-900/75 absolute inset-0"></div>
        <div class="relative z-10 flex flex-col items-center justify-center">
            <!-- Go Back Button -->
            <a href="/" class="absolute top-4 left-4 md:top-8 md:left-8 text-white text-lg md:text-xl p-2 rounded-full hover:bg-white/20 transition-colors">
                <i class="fas fa-arrow-left"></i>
            </a>
            <h1 class="text-4xl md:text-5xl font-extrabold mb-4 mt-8">Conceptual Brain Scan Analysis</h1>
            <p class="text-lg md:text-xl opacity-80 max-w-3xl mx-auto">
                Upload a brain MRI scan to receive a conceptual analysis. The tool uses a pre-trained model to classify images into different categories of tumors or normal scans.
            </p>
        </div>
    </div>

    <!-- Disclaimer Section -->
    <div class="bg-orange-50 border border-orange-200 text-red-700 p-4 mb-2 max-w-5xl mx-auto mt-4">
        <h2 class="text-2xl font-bold mb-2">Medical Disclaimer</h2>
        <p class="text-base">This tool is for conceptual and informational purposes only. It is not intended to be a substitute for professional medical advice, diagnosis, or treatment. Always seek the advice of your physician or other qualified health provider with any questions you may have regarding a medical condition.</p>
    </div>
    
    <!-- Dividing the area into 2 columns for image upload and analysis output -->
    <div class="container mx-auto p-4 md:p-8">
        <main class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div id="upload-section" class="upload-section bg-white rounded-lg shadow-md p-6">
    <h2 class="text-xl font-bold mb-4">1. Upload Your Scan</h2>
    <div id="drop-area" 
         class="border-2 border-dashed border-gray-300 rounded-lg p-6 mb-4 flex flex-col items-center justify-center text-center h-96 transition-colors duration-200 hover:border-blue-400 cursor-pointer">
        <input type="file" id="file-input" class="hidden" accept="image/*">

        <!-- Placeholder content -->
        <div id="placeholder" class="flex flex-col items-center">
            <svg class="w-16 h-16 text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            <p class="text-sm text-gray-500 font-medium">Drag & Drop or Click to upload an MRI scan (JPG, PNG)</p>
        </div>

        <!-- Image preview (hidden initially) -->
        <img id="preview" style="max-width:100%; max-height:100%; display:none; object-fit:contain;">
    </div>

    <button id="analyze-btn" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg shadow-md transition-transform duration-200 hover:scale-[1.01] hover:bg-blue-700 disabled:opacity-50" disabled>
        Analyze Scan 
    </button>
</div>
    
            
            <div class="results-section bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-bold mb-4">2. Analysis</h2>
                <div id="status-area" class="flex flex-col items-center justify-center text-center py-4 hidden">
                    <div id="loader" class="border-4 border-gray-200 border-t-blue-500 rounded-full w-12 h-12 animate-spin mb-4 hidden"></div>
                    <p id="status-message" class="text-gray-600"></p>
                </div>
                <div id="analysis-results">                 
                </div>
            </div>
            
       <script>
const dropArea = document.getElementById("drop-area");
const fileInput = document.getElementById("file-input");
const preview = document.getElementById("preview");
const placeholder = document.getElementById("placeholder");
const analyzeBtn = document.getElementById("analyze-btn");

// Drag & Drop events
dropArea.ondragover = (e) => {
    e.preventDefault();
    dropArea.style.borderColor = "#00f";
};

dropArea.ondragleave = () => {
    dropArea.style.borderColor = "#ccc";
};

dropArea.ondrop = (e) => {
    e.preventDefault();
    dropArea.style.borderColor = "#ccc";
    handleFile(e.dataTransfer.files[0]);
};

// Click to select
dropArea.addEventListener("click", () => fileInput.click());
fileInput.addEventListener("change", () => handleFile(fileInput.files[0]));

function handleFile(file) {
    if (!file) return;
    if (!file.type.startsWith("image/")) { alert("Please upload an image file!"); return; }

    // Hide placeholder
    placeholder.style.display = "none";

    // Show image inside drop area
    preview.src = URL.createObjectURL(file);
    preview.style.display = "block";

    // Save file for backend use
    window.savedImage = file;

    // Enable analyze button
    analyzeBtn.disabled = false;
}

document.getElementById("analyze-btn").addEventListener("click", async function() {
    const resultsDiv = document.getElementById("analysis-results");

    if (!window.savedImage) {
        alert("Please upload an image first!");
        return;
    }

    // Show loader
    resultsDiv.innerHTML = "<p class='text-gray-500'>Analyzing scan...</p>";

    // Prepare form data
    const formData = new FormData();
    formData.append("image", window.savedImage);

    try {
        const response = await fetch("/predict", {
            method: "POST",
            body: formData
        });

        const data = await response.json();

        if (data.error) {
            resultsDiv.innerHTML = `<p class='text-red-600 text-lg font-semibold'>Error: ${data.error}</p>`;
        } else {
            resultsDiv.innerHTML = `<p class='text-blue-600 text-lg font-semibold'>
            Prediction: ${data.prediction}<br>
            Confidence: ${data.confidence}</p>
            <p class='text-black text-lg font-normal mt-2'>
            ${data.info}
            </p>`;
            
        }
    } catch (err) {
        resultsDiv.innerHTML = `<p class='text-red-600 font-semibold'>Error contacting server</p>`;
        console.error(err);
    }
});

</script>

        </main>
    </div>



    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-400 text-center py-6 text-base">
        Shana Ibatuan   |   2025 SPIS   |   UC San Diego 
    </footer>

    <!-- JavaScript file -->
    <script type="module" src="{{ url_for('static', filename='script.js') }}"></script>

</body>
</html>